#!/bin/bash
#
# C4 Queue Omega Init Script - v1.1
#
# Modified by Nimesh Jethwa <njethwa@cirruscomputing.com>
#
# Copyright (c) 1996-2015 Free Open Source Solutions Inc.
# All Rights Reserved 
#
# Free Open Source Solutions Inc. owns and reserves all rights, title,
# and interest in and to this software in both machine and human
# readable forms.
#


DESC="C4 Queue Omega service"
SCRIPTNAME=`basename $0`

. /lib/lsb/init-functions

PIDFILE=/var/run/${SCRIPTNAME}.pid

case "$1" in
    start)
        log_daemon_msg "Starting $DESC" "$NAME"
        su c4 -c "cd /home/c4/bin/ && perl /home/c4/bin/c4q_omega.pl &" >> /var/log/c4/c4_omega.log 2>&1
	START_RESULT=$?
	[ $START_RESULT -eq 0 ] && ps -aef | grep /home/c4/bin/c4q_omega.pl | grep perl | awk '{ print $2 }' >$PIDFILE
        log_end_msg $START_RESULT
        ;;
    stop)
        log_daemon_msg "Stopping $DESC" "$NAME"
	if [ -e $PIDFILE ]; then
		 kill `cat $PIDFILE`
		rm $PIDFILE
	fi
        log_end_msg $?
        ;;
    restart)
	$0 stop
	$0 start
	;;
    *)
        echo "Usage: ${SCRIPTNAME} {start|stop}" >&2
        exit 1
        ;;
esac

exit 0
